# Warehouse Reminder Function

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö —Å–∫–ª–∞–¥–∞ –∑–∞ 24 —á–∞—Å–∞ –¥–æ —Ä–∞–∑–≥—Ä—É–∑–∫–∏.

## –û–ø–∏—Å–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**: –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏ –µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –±–æ—Ç–∞**: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–ª–∏–µ–Ω—Ç–µ –∏ –≥—Ä—É–∑–µ

## URL —Ñ—É–Ω–∫—Ü–∏–∏

```
https://functions.poehali.dev/47b18b0a-4e91-45d8-ba83-2533c3b49979
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Cron-–∑–∞–¥–∞—á–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤ 10:00 —É—Ç—Ä–∞:

```bash
# –í Yandex Cloud Functions —Å–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä —Ç–∏–ø–∞ "–¢–∞–π–º–µ—Ä"
# Cron –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: 0 10 * * ? *
# –û–ø–∏—Å–∞–Ω–∏–µ: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 10:00 –ø–æ –ú–°–ö
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–Ω–µ—à–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, cron-job.org) –¥–ª—è POST-–∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X POST https://functions.poehali.dev/47b18b0a-4e91-45d8-ba83-2533c3b49979
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:

```bash
curl -X POST https://functions.poehali.dev/47b18b0a-4e91-45d8-ba83-2533c3b49979
```

–û—Ç–≤–µ—Ç:
```json
{
  "message": "Reminders sent",
  "total_bookings": 5,
  "sent": 5
}
```

## –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ä–∞–∑–≥—Ä—É–∑–∫–µ

–ó–∞–≤—Ç—Ä–∞ 25.11.2025 –≤ 14:00 –≤–∞—Å –∂–¥—É—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ!

üìã –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:
üè¢ –ö–æ–º–ø–∞–Ω–∏—è: –û–û–û "–ü—Ä–∏–º–µ—Ä"
üì± –¢–µ–ª–µ—Ñ–æ–Ω: +79001234567
üöö –¢–°: –ì–∞–∑–µ–ª—å
üì¶ –ì—Ä—É–∑: –°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã, 5 –ø–∞–ª–ª–µ—Ç

‚è∞ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–±—É–¥—å—Ç–µ –≤–æ–≤—Ä–µ–º—è!
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å - —Å–æ–æ–±—â–∏—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ.
```

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
```
üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –∑–∞–≤—Ç—Ä–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∞

–ë–æ—Ç: –°–∫–ª–∞–¥ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞

üìÖ –î–∞—Ç–∞: 25.11.2025
üïê –í—Ä–µ–º—è: 14:00

üë§ –ö–ª–∏–µ–Ω—Ç:
‚Ä¢ Telegram: @username (ID: 123456789)
‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +79001234567
‚Ä¢ –ö–æ–º–ø–∞–Ω–∏—è: –û–û–û "–ü—Ä–∏–º–µ—Ä"

üöö –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: –ì–∞–∑–µ–ª—å
üì¶ –ì—Ä—É–∑: –°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã, 5 –ø–∞–ª–ª–µ—Ç

–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ID: 42
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –¥–∞—Ç—É "–∑–∞–≤—Ç—Ä–∞" (today + 1 day)
2. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–∑ –ë–î –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
   - –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –±–æ—Ç–∞
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- `psycopg2-binary==2.9.9` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- `aiogram==3.4.1` - –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `DATABASE_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–æ –ª–æ–≥–∞–º –≤ Yandex Cloud –∏–ª–∏ —á–µ—Ä–µ–∑ —Ä—É—á–Ω–æ–π –∑–∞–ø—Ä–æ—Å.

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "message": "Reminders sent",
  "total_bookings": 3,
  "sent": 3
}
```

–ï—Å–ª–∏ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:
```json
{
  "message": "No bookings to remind",
  "count": 0
}
```

## Troubleshooting

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω –≤ Yandex Cloud
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –±–æ—Ç–æ–≤ —É–∫–∞–∑–∞–Ω—ã admin_telegram_ids
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ "Failed to send reminder to user"

- –ë–æ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å telegram_token –≤ –ë–î

### –û—à–∏–±–∫–∞ "Failed to send reminder to admin"

- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–≥ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å admin_telegram_ids –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞
